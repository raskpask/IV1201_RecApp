language: node_js
node_js:
  - "10"

addons:
  hosts:
    - localhost

services:
  - postgresql
  
install:
  - npm install newman

before_script:
  - node --version
  - npm --version
  - node_modules/.bin/newman --version
  - pscl -c "CREATE DATABASE testDatabase WITH TEMPLATE = template0 ENCODING = 'UTF8' LC_COLLATE = 'en_US.UTF-8' LC_CTYPE = 'en_US.UTF-8';" -U postgres
  - psql -f ./tests/testDatabase.sql -U postgres
  - npm start &
env:
  global:
    -DATABASE_URL='postgres://postgres@127.0.0.1:5432/'


script:

  - node_modules/.bin/newman run tests/IV1201_API_test.postman_collection.json -e tests/IV1201_RecApp.postman_environment.json --color auto --disable-unicode